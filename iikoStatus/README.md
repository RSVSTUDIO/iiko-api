# iikoStatus

Простой PHP пример проверки статуса заказа доставки в Айко. 
Считаем, что клиент в строке поиска (отслеживаемый номер) может указать или номер заказа (если знает), или номер телефона, указанный при оформлении доставки. Необходимо для каждого заказа из базы установить степень "похожести" отслеживаемого номера и двух номеров: номера заказа и номера телефона. 
Результат поиска: статус заказа с максимальной "похожестью".

## Подключение лицензии Айко

Эксперименты с тестовым аккаунтом можно проводить бесплатно:

- имя пользователя demoDelivery
- пароль PI1yFaKFCGvvJKi

Для работы со своим заведением доставки потребуется лицензия API iikoDelivery. Инструкция по подключению лицензии: https://ru.iiko.help/articles/#!api-documentations/kak-podkluchit-api.
Если используется колл-центр, лицензию необходимо добавлять к колл-центру.
Вместо самостоятельного добавления лицензии настоятельно рекомендуется запросить подключение у вашего менеждера в Айко.

## Алгоритм работы примера

1. Запрос токена доступа (метод auth/access_token). Далее все обращения к API выполняются с указанием полученного токена доступа.
1. Получение списка организаций, осуществляющих доставку (метод organization/list). Если список пустой, проблема в лицензии. Возможные причины проблемы: лицензия не оплачена, лицензия подключена не к той организации.
1. Получение списка доставок выбранной организации за период времени (метод orders/deliveryOrders).
1. Разбор полученного массива на отдельные заказы, определение степени "похожести" (метод PHP [similar_text](http://php.net/manual/ru/function.similar-text.php)) отслеживаемого номера, номера заказа и номера телефона клиента. 
1. Сортировка массива заказов по убыванию степени "похожести".
1. Вывод статусов заказов, у которых степень "похожести" выше пороговой. Порог определяется экспериментально и условно соответствует допустимому количеству ошибок в указанном номере. Например, при допуске одной ошибки в номере из 11 цифр значение порога может быть выбрано >94%.

## Документация

* iikoBiz API: https://docs.google.com/document/d/1pRQNIn46GH1LVqzBUY5TdIIUuSCOl-A_xeCBbogd2bE
* iikoCard API: https://docs.google.com/document/d/1kuhs94UV_0oUkI2CI3uOsNo_dydmh9Q0MFoDWmhzwxc
* https://examples.iiko.ru

## Авторы

Пример разработан в "КвикФуд Технологиях" (https://kvikfud.tech). "Боевой" вариант применения: http://kvikfud.tech/status.